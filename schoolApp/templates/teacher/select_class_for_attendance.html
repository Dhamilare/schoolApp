{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}Select Class for Attendance{% endblock %}

{% block content %}
<div class="flex items-center justify-center min-h-[calc(100vh-160px)] px-4 py-8"> {# Added py-8 for vertical padding #}
    <div class="bg-white p-8 md:p-10 rounded-xl shadow-2xl w-full max-w-lg border border-gray-200 transform animate-fade-in-down"> {# Enhanced shadows and added animation #}
        <h2 class="text-4xl font-extrabold text-center bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent mb-8"> {# Gradient title #}
            <i class="fas fa-calendar-check mr-3"></i>Mark Daily Attendance
        </h2>

        <form id="attendanceSelectionForm" class="space-y-6">
            {% csrf_token %} {# Still good practice even for GET forms to prevent warnings #}
            <div>
                <label for="class_select" class="block text-lg font-semibold text-gray-800 mb-2">Select Class:</label>
                <select id="class_select" name="class_slug" class="mt-1 block w-full px-4 py-2 text-base border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-200 ease-in-out"> {# Enhanced styling #}
                    <option value="">-- Choose Class --</option>
                    {% for class_obj in classes %}
                        <option value="{{ class_obj.slug }}">{{ class_obj.name }}</option> {# Use class_obj.slug here #}
                    {% endfor %}
                </select>
                <p id="classError" class="text-red-600 text-sm font-medium mt-2 hidden"><i class="fas fa-exclamation-circle mr-1"></i>Please select a class.</p> {# Enhanced error styling #}
            </div>

            <div>
                <label for="attendance_date" class="block text-lg font-semibold text-gray-800 mb-2">Select Date:</label>
                <input type="date" id="attendance_date" name="date" value="{{ today }}" class="mt-1 block w-full px-4 py-2 text-base border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-200 ease-in-out"> {# Enhanced styling #}
                <p id="dateError" class="text-red-600 text-sm font-medium mt-2 hidden"><i class="fas fa-exclamation-circle mr-1"></i>Please select a date.</p> {# Enhanced error styling #}
            </div>

            <button type="submit" class="w-full bg-gradient-to-r from-primary to-secondary hover:from-indigo-700 hover:to-indigo-800 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 flex items-center justify-center group"> {# Gradient button, larger padding #}
                <i class="fas fa-arrow-right mr-3 group-hover:translate-x-1 transition-transform duration-300"></i>Proceed to Mark Attendance
            </button>
        </form>

        <div class="mt-8 text-center">
            <a href="{% url 'attendance_history' %}" class="inline-flex items-center text-primary hover:text-indigo-700 font-semibold text-lg transition duration-300 transform hover:scale-105"> {# Styled as a more prominent link #}
                <i class="fas fa-history mr-3"></i>View Attendance History
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('attendanceSelectionForm');
        const classSelect = document.getElementById('class_select');
        const attendanceDate = document.getElementById('attendance_date');
        const classError = document.getElementById('classError');
        const dateError = document.getElementById('dateError');

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            let isValid = true;
            if (classSelect.value === "") {
                classError.classList.remove('hidden');
                isValid = false;
            } else {
                classError.classList.add('hidden');
            }

            if (attendanceDate.value === "") {
                dateError.classList.remove('hidden');
                isValid = false;
            } else {
                dateError.classList.add('hidden');
            }

            if (isValid) {
                // IMPORTANT: Use classSelect.value directly, which now holds the slug
                const classSlug = classSelect.value;
                const date = attendanceDate.value;
                // Redirect using GET to the mark_attendance view, passing slug
                window.location.href = `/attendance/mark/${classSlug}/${date}/`;
            }
        });
    });
</script>
{% endblock %}
