{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Select Class for Attendance{% endblock %}

{% block content %}
<div class="flex items-center justify-center min-h-[calc(100vh-160px)] px-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-200">
        <h2 class="text-3xl font-bold text-center text-primary mb-6">
            <i class="fas fa-calendar-check mr-2"></i>Mark Daily Attendance
        </h2>

        <form id="attendanceSelectionForm" class="space-y-6">
            {% csrf_token %}
            <div>
                <label for="class_select" class="block text-sm font-medium text-gray-700 mb-1">Select Class:</label>
                <select id="class_select" name="class_id" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md shadow-sm">
                    <option value="">-- Choose Class --</option>
                    {% for class_obj in classes %}
                        <option value="{{ class_obj.id }}">{{ class_obj.name }}</option>
                    {% endfor %}
                </select>
                <p id="classError" class="text-red-500 text-xs mt-1 hidden">Please select a class.</p>
            </div>

            <div>
                <label for="attendance_date" class="block text-sm font-medium text-gray-700 mb-1">Select Date:</label>
                <input type="date" id="attendance_date" name="date" value="{{ today }}" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md shadow-sm">
                <p id="dateError" class="text-red-500 text-xs mt-1 hidden">Please select a date.</p>
            </div>

            <button type="submit" class="w-full bg-primary hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-md shadow-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 flex items-center justify-center">
                <i class="fas fa-arrow-right mr-2"></i>Proceed to Mark Attendance
            </button>
        </form>

        <div class="mt-8 text-center">
            <a href="{% url 'attendance_history' %}" class="text-primary hover:underline font-semibold">
                <i class="fas fa-history mr-2"></i>View Attendance History
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('attendanceSelectionForm');
        const classSelect = document.getElementById('class_select');
        const attendanceDate = document.getElementById('attendance_date');
        const classError = document.getElementById('classError');
        const dateError = document.getElementById('dateError');

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            let isValid = true;
            if (classSelect.value === "") {
                classError.classList.remove('hidden');
                isValid = false;
            } else {
                classError.classList.add('hidden');
            }

            if (attendanceDate.value === "") {
                dateError.classList.remove('hidden');
                isValid = false;
            } else {
                dateError.classList.add('hidden');
            }

            if (isValid) {
                const classId = classSelect.value;
                const date = attendanceDate.value;
                // Redirect using GET to the mark_attendance view
                window.location.href = `/attendance/mark/${classId}/${date}/`;
            }
        });
    });
</script>
{% endblock %}
